/**
 * Flex Field Setter component
 *
 * Version 1.0.1
 *
 * Changelog
 *  1.0.0 - First implementation
 *  1.0.1 - Fix Textarea fields
 *
 * Usage
 */
!function(e){"use strict";var t="",i=function(t,i,o){this.FieldSetterObj=t,this.FieldCounter=o,this.fieldNamePrefix=i,this.row=null,this.setData=function(e){void 0===e.field&&(e.field=""),void 0===e.mode&&(e.mode="value"),void 0===e.value&&(e.value=""),this.row.find('[rel="field"]').select2("val",e.field),this.row.find('[rel="mode"]').select2("val",e.mode),this.updateField(e.value)},this.addHTML=function(){return this.row=e('<div style="margin:10px;" class="FlexFieldSetterRow" id="setterRow_'+this.FieldCounter+'"></div>'),!1===this.FieldSetterObj.IsDynamicFieldLoader()?this.row.append("<select class='FieldSetterField MakeSelect2' rel='field' name='"+this.fieldNamePrefix+"[field]' id='"+this.FieldCounter+"_field'>"+this.FieldSetterObj.getFieldOptions()+"</select>"):this.row.append("<input type='hidden' class='FieldSetterField MakeHiddenSelect2' rel='field' name='"+this.fieldNamePrefix+"[field]'  id='"+this.FieldCounter+"_field' />"),this.row.append('<select class="FieldSetterMode select2" style="height:29px;vertical-align:top;" rel="mode" name="'+this.fieldNamePrefix+'[mode]" id="setter_'+this.FieldCounter+'_mode">\n            <option value="value">Text</option>\n        </select>'),this.row.append("<div id='value_"+this.FieldCounter+'_container\' class="FieldSetterValueContainer"></div>'),this.FieldSetterObj.fieldContainer.append(this.row),this.registerEvents(),this.row},this.registerEvents=function(t){this.row.find(".FieldSetterMode").on("change",e.proxy(function(){this.updateField()},this)),this.row.find(".FieldSetterField").on("change",e.proxy(function(){this.updateField()},this)),this.row.find(".FieldSetterField").trigger("change"),this.FieldSetterObj.InitSelect2()},this.updateField=function(e){void 0===e&&(e=""),this.row.find(".FieldSetterValueContainer").html(this.getValueInput(e)),this.FieldSetterObj.InitSelect2()},this.getValueInput=function(e){var t=this.row.find(".FieldSetterField").select2("val");this.row.find(".FieldSetterMode").val();void 0===e&&this.row.find(".FieldSetterValue").length>0&&(e=this.row.find(".FieldSetterValue").val()),void 0===e&&(e="");var i="setter_"+this.FieldCounter+"_value",o=this.fieldNamePrefix+"[value]";if(void 0===this.FieldSetterObj.fieldData[t])return'<em style="line-height:28px;color:#777777;">-'+app.vtranslate("TXT_CHOOSE_VALID_FIELD")+" -</em>";var n=this.FieldSetterObj.fieldData[t].type.name,d={};switch(n){case"owner":var s="<select style='width:100%;' class='MakeSelect2 condition_value select' name='"+o+"' id='"+i+"'>";return s+="<option "+("$current_user_id"==e?"selected='selected'":"")+" value=''>$current_user_id</option>",jQuery.each(this.FieldSetterObj.availableUsers,function(t,i){s+="<option "+(e==t?"selected='selected'":"")+" value='"+t+"'>"+i+"</option>"}),s+="</select>";case"picklist":s="<select style='width:100%;' class='MakeSelect2 condition_value select' "+("multipicklist"==n?"multiple='multiple'":"")+" name='"+o+"' id='"+i+"'>";var A=this.FieldSetterObj.cbGetPicklistValues(t);return jQuery.each(A,function(t,i){s+="<option "+(""!=t&&-1!=e.indexOf(t)||""==t&&t==e?"selected='selected'":"")+" value='"+t+"'>"+i+"</option>"}),s+="</select>";case"multipicklist":s="<select style='width:100%;' class='select2 condition_value select' "+("multipicklist"==n?"multiple='multiple'":"")+" name='"+o+"[]' id='"+i+"'>",A=this.FieldSetterObj.cbGetPicklistValues(t);return jQuery.each(A,function(t,i){s+="<option "+(-1!=e.indexOf(t)?"selected='selected'":"")+" value='"+t+"'>"+i+"</option>"}),s+="</select>";case"boolean":return s='<input name="'+o+'" value="1" id="'+i+'" type="checkbox" '+("1"==e?"checked='checked'":"")+">";case"reference":this.complexeConditionObj.fieldData[t].type.refersTo[0];return d.refFields=!0,s=a(o,i,e,d,this.FieldSetterObj.mainSourceModule);case"date":case"datetime":return a(o,i,e,{module:this.FieldSetterObj.mainSourceModule,refFields:!1});case"text":return s=function(e,t,i,a,o){void 0!==i&&null!=i||(i="");0==t&&(t=e.replace(/[^a-zA-Z0-9_]+/g,"_"));void 0===a&&(a={});void 0===o&&(o=!0);void 0===a.module&&"undefined"!=typeof moduleName&&(a.module=moduleName);void 0===a.style&&(a.style="");void 0===a.module&&(a.module="");void 0===a.mode&&(a.mode="");void 0===a.class&&(a.class="");void 0===a.placeholder&&(a.placeholder="");void 0===a.height&&(a.height="150px");void 0===a.type&&(a.type="0");void 0===a.refFields&&(a.refFields=!1);var n="<span class='templateFieldSpan' style='display:flex;'>";n+="<textarea id='"+t+"' placeholder='"+a.placeholder+"' style='height: "+a.height+"; "+a.style+"' name='"+e+"' style='' class='templateField "+a.class+" "+("expression"==a.mode?" customFunction ":"")+"'>"+l(i)+"</textarea>",o&&(n+="<span class='templateFieldBtn templateFieldButton' >","expression"!=a.mode?n+="<img class='templateFieldButton' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAHdElNRQfjBA8CIxxYy4paAAAAnElEQVQoz5WRsQ4BQRRFDzaUVBpbS0Qi0fkBH0Gz/ooOP6RSa9b4ACKxJHs1GztPZiTONPPunLzkvQGfFRfOLImQ8kKIgn4dNo2QANBmEO7Q4YgQh0oEoGGULhkle2511DJCwZ0Tjig7hNjEnieoOsPwFArcvtgixJofjBnZIDFVjzkljusfi/KZfaaYhoWUJ0I8/M+yZDhyFn70BtrhMDokCc6yAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTA0LTE1VDAwOjM1OjI4KzAyOjAwZI0qbAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0wNC0xNVQwMDozNToyOCswMjowMBXQktAAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC' data-references='([source]: ([module]) [destination])' data-functions='true' data-replace='false' data-options='{\"refFields\":\""+a.refFields+'", "module": "'+a.module+'", "type":"'+a.type+"\"}' id='templateIcon_"+t+"'  style='margin-bottom:-5px;cursor:pointer;'>":n+="<img class='templateFieldButton'  src='modules/Workflow2/icons/templatefieldPHP.png' id='templateIcon_"+t+"'  data-references='[source]->[module]->[destination]' data-functions='true' data-replace='false' data-options='{\"refFields\":\""+a.refFields+'", "module": "'+a.module+'", "type":"'+a.type+"\"}'  style='margin-bottom:-5px;width:24px;height:24px;cursor:pointer;'>",n+="</span>");return n+="</span>"}(o,i,e,{height:"80px",width:"100%",module:this.FieldSetterObj.mainSourceModule,refFields:!1});default:return a(o,i,e,{module:this.FieldSetterObj.mainSourceModule,refFields:!1})}}};function l(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function a(e,t,i,a){null==i&&(i=""),0==t&&(t=e.replace(/[^a-zA-Z0-9_]+/g,"_")),void 0===a&&(a={}),void 0===a.module&&"undefined"!=typeof moduleName&&(a.module=moduleName),void 0===a.refFields&&(a.refFields=!1),void 0===a.mode&&(a.mode=""),void 0===a.class&&(a.class=""),void 0===a.style&&(a.style=""),void 0===a.disabled||0==a.disabled?a.disabled="":a.disabled="disabled='disabled'",void 0===a.type&&(a.type="0"),void 0===a.uitype&&(a.uitype=[]),void 0===a.delimiter&&(a.delimiter=""),void 0===a.title&&(a.title=""),void 0===a.datalist&&(a.datalist=""),void 0===a.fieldType&&(a.fieldType="text"),void 0===a.readonly&&(a.readonly=!1),void 0===a.placeholder&&(a.placeholder=""),void 0===a.variables&&(a.variables=!0),void 0===a.width&&(a.width="600px"),void 0===a.module&&(a.module=""),void 0===a.dataAttr&&(a.dataAttr=!1),a.class+=" condition_value text textfield templateField initAutocomplete form-control";var o="";jQuery.each(a.dataAttr,function(e,t){o+=" data-"+e+'="'+t+'"'});var n=a.uitype.join(","),d="<input autocomplete='false' type='"+a.fieldType+"' data-currentvalue='"+l(i)+"' "+o+" "+(""!==a.datalist?'list="'+a.datalist+'"':"")+" title='"+a.title+"' placeholder='"+a.placeholder+"'  alt='"+a.title+"' data-delimiter='"+a.delimiter+"' ondblclick='dblClickTextfield(\""+t+"\");' "+a.disabled+"style='width:100% !important;float:left;"+a.style+"' data-module='"+a.module+"' class='"+a.class+"' name='"+e+"' id='"+t+"' "+(!0===a.readonly?'readonly="readonly"':"")+' value="'+(!1!==i?l(i):"")+'">';return 1==a.variables?"expression"!=a.mode?d+="<span class='templateFieldBtn templateFieldButton' data-references='([source]: ([module]) [destination])' data-functions='true' data-replace='false' data-options='{\"refFields\":\""+a.refFields+'", "module": "'+a.module+'", "uitypes": "'+n+'", "type":"'+a.type+"\"}' ><img src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAHdElNRQfjBA8CIxxYy4paAAAAnElEQVQoz5WRsQ4BQRRFDzaUVBpbS0Qi0fkBH0Gz/ooOP6RSa9b4ACKxJHs1GztPZiTONPPunLzkvQGfFRfOLImQ8kKIgn4dNo2QANBmEO7Q4YgQh0oEoGGULhkle2511DJCwZ0Tjig7hNjEnieoOsPwFArcvtgixJofjBnZIDFVjzkljusfi/KZfaaYhoWUJ0I8/M+yZDhyFn70BtrhMDokCc6yAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTA0LTE1VDAwOjM1OjI4KzAyOjAwZI0qbAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0wNC0xNVQwMDozNToyOCswMjowMBXQktAAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC' id='templateIcon_"+t+"'  style='margin-bottom:-5px;cursor:pointer;'></span>":d+="<span class='templateFieldBtn templateFieldButton' data-references='[source]->[module]->[destination]' data-functions='false' data-replace='false' data-options='{\"module\": \""+a.module+"\"}'  id='task_condition_iconspan'><img src='modules/Workflow2/icons/templatefieldPHP.png' style='margin-bottom:-2px;cursor:pointer;'>":d+="<span class='templateFieldBtn templateFieldResetButton' style='position: absolute;top:0;right: 0px;'><img src='modules/Workflow2/icons/clear.png' alt='"+MOD.LBL_VALUE_CLEAR+"' title='"+MOD.LBL_VALUE_CLEAR+"' style='margin-bottom:-5px;cursor:pointer;'></span>","<span class='templateFieldSpan'>"+d+"</span>"}Array.prototype.last=function(){return this[this.length-1]},void 0===jQuery.assocArraySize&&(jQuery.assocArraySize=function(e){var t,i=0;for(t in e)e.hasOwnProperty(t)&&i++;return i});var o,n={},d=null;function s(e,t){if(void 0===t)t=!1;if(void 0!==e&&0!=jQuery("#"+e).length){var i=jQuery("#pageOverlay");jQuery("#pageOverlayContent");1!=t?i.animate({opacity:0}):i.hide()}else jQuery("#pageOverlay").hide("fast")}window.FlexFieldSetter=function(l,a){this.dynamicFieldMode=!1,this.moduleFields=null,this.configuration=[],this.parentEle=e(l),this.fieldContainer=null,this.addFieldBtn=null,this.fieldCounter=0,this.fieldOptionsHTMLCache=null,this.mainTargetModule=null,this.mainSourceModule=null,this.requiredOnInit=[],this.fieldData={},this.availableUsers=null;var A=this;this.fieldNamePrefix=void 0===a?"fieldsetter":a;var r=function(e){A.requiredOnInit.push(e)};this.setScopeName=function(e){t=e},this.setMainTargetModule=function(e){this.mainTargetModule=e},this.setMainSourceModule=function(e){this.mainSourceModule=e},this.setConfiguration=function(e){this.configuration=e},this.IsDynamicFieldLoader=function(){return 1==this.dynamicFieldMode},this.cbGetPicklistValues=function(e){return this.fieldData[e].type.picklistValues},this.setAvailableUser=function(e){this.availableUsers=e},this.setModuleFields=function(e){"function"==typeof e&&(this.dynamicFieldMode=!0),this.moduleFields=e,"object"==typeof e&&(this.fieldData={},jQuery.each(this.moduleFields,jQuery.proxy(function(e,t){jQuery.each(t,jQuery.proxy(function(e,t){"string"==typeof t.type&&(t.type={name:t.type}),"crmid"!=t.name&&-1===t.name.indexOf(" crmid)")||(t.type={name:"crmid"}),this.fieldData[t.name]=t},this))},this)))},this.init=function(){0==e(".FIELDSETTERSTYLES").length&&e("body").append('<style type="text/css" class="FIELDSETTERSTYLES">.FlexFieldSetterRow{display:flex;flex-direction:row}.FlexFieldSetterRow .FieldSetterField{width:40%;min-width:350px;flex-grow:0;flex-shrink:0}.FlexFieldSetterRow .FieldSetterMode{width:100px;margin:0 5px;flex-grow:0;flex-shrink:0}.FlexFieldSetterRow .FieldSetterValueContainer{flex-grow:1;flex-shrink:0;width:40%}.FlexFieldSetterRow .FieldSetterValueContainer textarea{flex-grow:1}.FlexFieldSetterRow .templateFieldSpan textarea{border-right:none}</style>'),null===this.moduleFields&&r("fields"),null===this.availableUsers&&r("users"),null===this.moduleFields?e.post("index.php?module="+t+"&action=FieldSetter&mode=init",{mainModule:this.mainTargetModule,required:this.requiredOnInit},e.proxy(function(e){void 0!==e.fields&&this.setModuleFields(e.fields),void 0!==e.users&&this.setAvailableUser(e.users),this.afterLoadFields()},this),"json"):this.afterLoadFields()},this.afterLoadFields=function(){this.fieldContainer=e("<div></div>"),this.parentEle.html('<button type="button" class="btn btn-primary addFieldSetterValueBtn">Add Field</button>'),this.parentEle.append(this.fieldContainer),this.addFieldBtn=e(".addFieldSetterValueBtn",this.parentEle),this.addFieldBtn.on("click",e.proxy(function(e){this.addRow()},this)),A.parentEle.on("click",".templateFieldButton",e.proxy(function(i){var l=jQuery(i.currentTarget),a=l.closest(".templateFieldSpan,.templateTextareaSpan").find(".templateField"),A=(a.attr("id"),l.data("options"));!function(i,l,a,A,r){if(!jQuery(i).attr("readonly")){var u=o;if(void 0!==r&&void 0!==r.module&&"undefined"!=r.module&&(u=r.module),void 0===u&&(u=moduleName),void 0!==u){void 0===r&&(r={}),d="function"==typeof r.callback?r.callback:null,null==l&&(l="[source]->[module]->[destination]"),null==a&&(a=!1),null==A&&(A=!1),a=0==a?0:1,void 0===r.type&&(r.type="0"),void 0===r.refFields&&(r.refFields="false"),void 0===r.uitypes&&(r.uitypes="");var c=r.uitypes.split(","),p=l+";;"+u+";;"+r.type+";;"+r.uitypes+";;"+r.refFields+";;functions"+a;0==jQuery("#insertTemplateFieldContainer").length&&jQuery("body").append("<div id='insertTemplateFieldContainer' style='display:none;'></div>"),void 0===n[p]&&(jQuery.ajaxSetup({async:!1}),jQuery("#insertTemplateFieldContainer").load("index.php?module="+t+"&action=TemplateVariables&mode=templateFields",{functions:a,uitypes:c,type:r.type,refFields:r.refFields,reftemplate:l,mainModule:u}),jQuery.ajaxSetup({async:!0}),n[p]=jQuery("#insertTemplateFieldContainer").html()),jQuery("#insertTemplateFieldContainer").html(n[p]),function(t,i,l,a,o){var n=jQuery.Deferred();if(0==(r=jQuery("#pageOverlay")).length){var d=e("<div id='pageOverlay' style='cursor:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAV1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOl5NtAAAAHXRSTlP+APnw7+XGwJNGQCZ4tZ6dnFgaGAjR0M97WlfSdwzyPaoAAACHSURBVBjTZU9bEoQgDAsF5KWIILqv+59zi7ozy5ivTNqmCQTD2ypltb5xFnLUBAbpmJuQJ4kLaiosRAk6NwgqCXgNmscBGMaZoD0sgR7hZcwzjEwt3uDhEpwLy8B0w+Fo3Lo6c/jehdqf7P+mn2Z6fyui6oNxdNVHFyX9yqUixFV/k3I/638BJxkF+5eYS7cAAAAASUVORK5CYII=), auto;position:fixed;z-index:1500;top:0;left:0;display:none;height:100%;width:100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWBAMAAADOL2zRAAAAElBMVEXCw8TT09PPz8/FxcbLy8zIyMmv866aAAAABnRSTlOwsLCwsLCTI7FOAAAETUlEQVRo3u1ZQZLiMAxUVcgDQvGBeLL3qQ08IENxT0H+/5YdTKCtakv23s0plOy4LSnqli2zPH/3cfj9XePzJT6fvp/P3c/z+fiIhnM0fEVDH5JB9+E1+0/8e1me/6YHTMdrMn8fFF8cXoO2OOj2jdUnOT0ATM9nYFs03BJgUzpIjvuaMNnAuhTYe3UAk2Fa498dczJ/ygHDoP7llhWD5NdnL8yJx+WezD+kwF6D9njtHv/MFjiTME96YwCGUCi3SNaZolMBwPpo4HhF9ELO5FDQi3W85vdsQZaYOcbApmyOCTvTz7G/0aDjtQ8Sy5kqeYMelI9XkNSZyvRjADunyZ+uvilndjDhxYgxJ7+c00H7ZiaV19aOH/tmMEiF4o35+l4TyZ/O73UoEK8zilU0jYQ5CwyDArllFoFpuEmCeeVQ7B7D6qeVPvdPlBhzTzumAqvcAsw3CmXnA5s4lHg1Rxk5hjqk0evV8cEWgNGgYAOb2JmXhSp3Op/ita/JzgRbZJL/nosXk4JK/tGiFK4JD7HYirnWL7Dg2lmx1ZAkv0FJHYCBa00aBVthY37lF12ikONgK5dSvpKwCNiKKr/vca788olySDCn8w9+5b+h8gswU5R9dcGJJLuJyk21ukDyiy/V+KvmHX/UoChnslSrVxfLIMmad1OqjUbyB5VjEmCa4Qyqg1lK6rQCjWC8SuIXWBUvVUmE2YoLrFr9kBKiZiuunVN2xxh0RyieJqZRa8eYn1UX2pm2unA9BmDMVmF3ZgCwvLoAiYsI57VZ+UldUPLDmR6NltUFPOazFQHjeIHS2BRWJvFgciU8Bsxk8pP/SKsbzrST346XhRmfO9qBQakLzrGqPuVW1VcK83P3xkwNs24mqFiJ06ewuvArv7jtAFKhpvJLjka7hdWF31eeNdcyZlYXvuwRr/s3zi6svlLIZDUza7GvFMOZdi9st2+Sd2Z3Hkiqza7smZdBVMtp5JhKfouEt1HojIekGgosh0Lt2GugAMwrsFidaJSS36CkB2v+LL8zjZaBFTAjx+rUBdIHmFlao8DS5+4AU2wTato3+LvMVifymKEuYGIaBVf66gLo66VaXSj7saoXZmlNs20axY7LyR/IY6ZUAzDaMeKVqyQsrbH+4PSVcc1in6J6YauvlEIv3AWq/CY9SIGtuq26fTsK5tefgjpcy8CW9MUDgPUjA8MgcZp0v/JzvEQ36ba6uJb7SgFbaWdYfaVzOCyVUo0LrM+1nPxK9swl2SMGjfaKRoPOMQBL3LIFoT6lpC42ltb7oLpT0EtGWnOxqj0FHehwmIuVyVbl9o2+Kr1m/Skon1obfcpkqguu/Fj9/45nfXXBznR74YGS3wRW7oUn93CYMfskzurCAza46mJlYAsGVWpITn4GxlLNbTlP9ql1u2Ntd6ztjrXdsbY71nbH2u5Y2x1ru2Ntd6ztjrXdsbY71nbH2u5YX8n/D4wVYjMqONy+AAAAAElFTkSuQmCC);'><div id='pageOverlayContent' style='position:fixed;cursor:default;top:100px;margin:auto;left:50%;padding:10px;background-color:#ffffff;'>&nbsp;</div></div>");d.on("click",function(){s()}),jQuery("body").append(d)}if(void 0===A)var A=!1;t+="<br>",t+='<div class="btn-group pull-right" style="text-align:center;margin-top:5px;padding:0 10px 10px;">',t+='<button class="btn btn-warning BtnCancel" onclick="">'+i.cancel+"</button>",t+='<button class="btn btn-success BtnOk">'+i.ok+"</button>",t+="</div>";var r=jQuery("#pageOverlay"),u=jQuery("#pageOverlayContent");return t='<img class="closePageOverlay" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAV1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOl5NtAAAAHXRSTlP+APnw7+XGwJNGQCZ4tZ6dnFgaGAjR0M97WlfSdwzyPaoAAACHSURBVBjTZU9bEoQgDAsF5KWIILqv+59zi7ozy5ivTNqmCQTD2ypltb5xFnLUBAbpmJuQJ4kLaiosRAk6NwgqCXgNmscBGMaZoD0sgR7hZcwzjEwt3uDhEpwLy8B0w+Fo3Lo6c/jehdqf7P+mn2Z6fyui6oNxdNVHFyX9yqUixFV/k3I/638BJxkF+5eYS7cAAAAASUVORK5CYII=" style="position:absolute;right:-5px;top:-5px;cursor:pointer;">'+t,"none"==r.css("display")?(u.css("width",l+"px"),u.css("marginLeft",l/2*-1+"px"),u.css("visibility","hidden"),r.css("opacity","0"),u.show(),r.show(),u.html(t),0!=A&&jQuery(A).length>0?(r.animate({opacity:1}),jQuery(A).effect("transfer",{to:u},250,function(){u.css("visibility","visible")})):(u.css("visibility","visible"),r.css("opacity","1"),r.show())):(u.html(t),u.animate({width:l+"px",marginLeft:l/2*-1+"px"},"fast",function(){})),u.find(".closePageOverlay").on("click",function(){s()}),jQuery(".BtnCancel").on("click",function(e){s(),n.resolve(!1)}),jQuery(".BtnOk").on("click",function(e){jQuery(".ModalResultValue","#pageOverlayContent").hasClass("chzn-select")?n.resolve("$"+jQuery(".ModalResultValue","#pageOverlayContent").select2("val")):n.resolve("$"+jQuery(".ModalResultValue","#pageOverlayContent").val()),s()}),jQuery("#pageOverlayContent").on("click.select2",function(e){e.preventDefault(),e.stopPropagation()}),jQuery("#pageOverlayContent").on("click",function(e){e.preventDefault(),e.stopPropagation()}),n.promise()}(jQuery("#insertTemplateFieldContainer").html(),{ok:"OK",cancel:"abbrechen"},500,i.parent().find(".templateFieldButton")).then(function(e){if(!1!==e){var t=i.data("delimiter");if("function"==typeof d){var l=d(e,{field:i.attr("id"),replace:A});if(!1===l)return}if(1==A)i.val(e);else{var a=i.val();void 0!==t&&a.length>0&&(a+=t),i.val(a+e)}i.trigger("insertText",[e]),i.trigger("change"),i.trigger("blur")}}),jQuery("#pageOverlayContent select.chzn-select").select2(),jQuery("#pageOverlayContent").on("click",function(e){e.stopPropagation()})}}}(a,l.data("references"),!0===l.data("functions"),!0===l.data("replace"),A)},A)),this.configuration.length>0&&e.each(this.configuration,e.proxy(function(e,t){this.addRow().setData(t)},this))},this.getFieldOptions=function(){if(null===this.fieldOptionsHTMLCache){var e="";jQuery.each(this.moduleFields,jQuery.proxy(function(t,i){e+="<optgroup label='"+t+"'>";for(var l=0;l<this.moduleFields[t].length;l++)e+="<option value='"+this.moduleFields[t][l].name+"'>"+this.moduleFields[t][l].label+"</option>";e+="</optgroup>"},this)),this.fieldOptionsHTMLCache=e}return this.fieldOptionsHTMLCache},this.addRow=function(){var e=new i(this,this.fieldNamePrefix+"["+this.fieldCounter+"]",this.fieldCounter);return e.addHTML(),this.fieldCounter++,e},this.InitSelect2=function(){var t;(t=e(".MakeSelect2",this.parentEle)).removeClass("MakeSelect2"),t.each(function(t,i){e(i).select2({closeOnSelect:"0"!=e(i).data("closeonselect")})}),!0===this.dynamicFieldMode&&((t=e(".MakeHiddenSelect2.FieldSetterField",this.parentEle)).removeClass("MakeHiddenSelect2"),t.each(e.proxy(function(t,i){e(i).select2({closeOnSelect:"0"!=e(i).data("closeonselect"),initSelection:e.proxy(function(e,t){var i=this.moduleFields(e.val(),!0);void 0!==i.id&&t(i)},this),query:e.proxy(function(e){var t=this.moduleFields(e.term,!1);e.callback(t)},this)})},this)))}}}(jQuery);